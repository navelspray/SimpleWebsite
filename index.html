<!DOCTYPE HTML>

<html>
	<head>
		<title>Hosting your D3 with style </title>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta name="description" content="" />
		<meta name="keywords" content="" />
		<!--[if lte IE 8]><script src="css/ie/html5shiv.js"></script><![endif]-->
		<script src="js/jquery.min.js"></script>
		<script src="js/jquery.dropotron.min.js"></script>
		<script src="js/jquery.scrollgress.min.js"></script>
		<script src="js/jquery.scrolly.min.js"></script>
		<script src="js/jquery.slidertron.min.js"></script>
		<script src="js/skel.min.js"></script>
		<script src="js/skel-layers.min.js"></script>
		<script src="js/init.js"></script>
		<noscript>
			<link rel="stylesheet" href="css/skel.css" />
			<link rel="stylesheet" href="css/style.css" />
			<link rel="stylesheet" href="css/style-xlarge.css" />
		</noscript>
		<!--[if lte IE 9]><link rel="stylesheet" href="css/ie/v9.css" /><![endif]-->
		<!--[if lte IE 8]><link rel="stylesheet" href="css/ie/v8.css" /><![endif]-->
	</head>
	<body class="landing">

		<!-- Header -->
			<header id="header" class="alt skel-layers-fixed">
				<h1><a href="index.html">HTML5 Website <span>by Html5webtemplates.co.uk</span></a></h1>
				<nav id="nav">
					<ul>
						<li><a href="index.html">Home</a></li>
						<li>
							<a href="information.html">Information</a>
							
						</li>
						<li><a href="elements.html">Elements</a></li>
					</ul>
				</nav>
			</header>

		<!-- Banner -->
			<section id="banner">
				<div class="inner">
					<h2>Survival on the titanic</h2>
					<p>An interactive visualisation exploring the survival of passengers on the titanic</p>
					<ul class="actions">
						<li><a href="#one" class="button big scrolly">Lets go</a></li>
					</ul>
				</div>
			</section>

		<!-- One -->
			<section id="one" class="wrapper style1">
				<div class="container">
					<header class="major">
						<h2>Lorem ipsum dolor</h2>
						<p>Ipsum dolor tempus commodo turpis adipiscing adipiscing in tempor placerat<br />
						sed amet accumsan enim lorem sem turpis ut. Massa amet erat accumsan curae<br />
						blandit porttitor faucibus in nisl nisi volutpat massa mi non nascetur.</p>
					</header>
					<div class="slider">
						<span class="nav-previous"></span>
						<div class="viewer">
							<div class="reel">
								<div class="slide">
									<img src="images/slide01.jpg" alt="" />
								</div>
								<div class="slide">
									<img src="images/slide02.jpg" alt="" />
								</div>
								<div class="slide">
									<img src="images/slide03.jpg" alt="" />
								</div>
							</div>
						</div>
						<span class="nav-next"></span>
					</div>
				</div>
			</section>
			
		<!-- Two -->
			<section id="two" class="wrapper style2">
				<div class="container">
					<div class="row uniform">
						<div class="4u 6u(2) 12u$(3)">
							<section class="feature fa-briefcase">
								<h3>Natoque phasellus</h3>
								<p>Ipsum dolor tempus commodo amet sed accumsan et adipiscing blandit porttitor sed faucibus.</p>
							</section>
							
							<!--START D3 ATTEMPT -->
							<script>
var chartWidth = 500;
var chartHeight = 500;

/********
 * Data *
 ********/

var allData = [];

/**************
 * Load Data  *
 **************/

var index = 0;

d3.csv("titanic passenger list.csv", (row, i) => {
  return {
    name: row.name,
    survived: (row.survived==1) ? "Yes": "No",
    sex: row.sex,
    age: +row.age,
    fare: +row.fare,
    key: i
  };
}).then(rows => {
  rows.sort(function(a,b) { return (a.name).localeCompare(b.name); });
  allData = rows;
  makeChart(rows.slice(index,index+10));
}).catch(error => {
  console.log(error);
});

var key = function(d){ return d.key; };

/**********
 * Scales *
 **********/
var x,y,c,s,r;


/********
 * Axes *
 ********/

var xAxis;
var yAxis;

/**************
 * Make Chart *
 **************/

function makeChart(data){

  // y position
  y = d3.scaleLinear()
      .domain(d3.extent(allData,function(d){ return d.age; }))
      .range([465,10]);

  // color
  c = d3.scaleOrdinal()
      .domain(["male","female"])
      .range(["#a6cee3","#fb9a99"]);

  // stroke
  s = d3.scaleOrdinal()
      .domain(["No","Yes"])
      .range(["#e31a1c","#1f78b4"]);

  // radius
  r = d3.scaleLinear()
      .domain([0,d3.max(allData,function(d){ return d.fare; })])
      .range([5,50]);

  var canvas = d3.select(".chart")
      .style("width",chartWidth)
      .style("height",chartHeight);

  update(data);

  xAxis = d3.axisBottom()
      .scale(x)
      .ticks(0);

  yAxis = d3.axisLeft()
      .scale(y);

  var yAxisGroup = canvas.append("g")
      .attr("class","axis")
      .attr("transform","translate(25,0)")
      .call(yAxis);

  yAxisGroup.selectAll("text")
      .attr("transform", "translate(-5,0)");

  yAxisGroup.append("text")
      .text("Passenger Age")
      .attr("transform", "rotate(-90)")
      .attr("y", 15)
      .attr("dx", -10)
      .style("text-anchor", "end");

  canvas.append("g")
      .attr("class","axis")
      .attr("transform","translate(0,"+(chartHeight-25)+")")
      .call(xAxis)
    .append("text")
      .text("Click to sample a new passenger.")
      .attr("x", chartHeight-15)
      .attr("dy", 12)
      .style("text-anchor", "end");

  canvas.on("click",function(){
    dataFetch(++index,index+10);
    index=index%allData.length;
  });

  genderLegend();
  survivedLegend();

}

/**********
 * Legend *
 **********/

function genderLegend() {
  // Draw the gender legend
  var legend = d3.select(".chart").selectAll(".legend")
      .data(c.domain().slice().reverse())
    .enter().append("g")
      .attr("class","legend")
      .attr("transform",function(d,i) {
        return "translate(0," + i * 20 + ")";
      });

  legend.append("rect")
      .attr("x",475)
      .attr("y",9)
      .attr("width",18)
      .attr("height",18)
      .style("fill",c);

  legend.append("text")
      .attr("x",465)
      .attr("y",18)
      .attr("dy",".35em")
      .style("text-anchor","end")
      .text(function(d) {
        return d.charAt(0).toUpperCase()+d.slice(1);
      });
}

function survivedLegend() {

  var group = d3.select(".chart").append("g")
      .attr("class","legend-group");

  group.append("text")
      .text("Passenger survived?")
      .attr("x",493)
      .attr("y",59)
      .style("font-weight","bold")
      .style("text-anchor","end");

  var legend = group.selectAll(".legend")
      .data(s.domain().slice().reverse())
    .enter().append("g")
      .attr("class","legend")
      .attr("transform",function(d,i) {
        return "translate(0," + i * 20 + ")";
      });

  legend.append("rect")
      .attr("x",475)
      .attr("y",65)
      .attr("width",18)
      .attr("height",18)
      .style("fill",s);

  legend.append("text")
      .attr("x",465)
      .attr("y",73)
      .attr("dy",".35em")
      .style("text-anchor","end")
      .text(function(d) { return d; });
}

/***************
 * Update Loop *
 ***************/

function update(data){

  //BIND DATA
  var scatter = d3.select(".chart").selectAll("circle")
      .data(data,key);

  // x position
  x = d3.scaleLinear()
      .domain([0,data.length-1])
      .range([35,490]);

  //UPDATE
  scatter.attr("stroke-width","5px");

  //ENTER
  var enter = scatter.enter().append("circle")
      .attr("fill-opacity",0.85)
      .attr("r",5)
      .attr("cx",function(d,i){ return x(i); })
      .attr("cy",function(d){ return y(d.age); })
      .attr("stroke",function(d){ return s(d.survived); })
    .on("mouseover",function(d){
      d3.select(this).transition()
        .attr("stroke-width","5px")
        .attr("r",r(d.fare));
    })
    .on("mouseout",function(){
      d3.select(this).transition()
        .delay(1000)
        .attr("stroke-width","0px")
        .attr("r",5);
    });

  // Add a title to the point (on mouseover)
  enter.append("svg:title")
      .text(function(d){ return d.name;});

  //ENTER + UPDATE
  enter.merge(scatter).transition().duration(1000)
      .attr("cx",function(d,i){ return x(i); })
      .attr("cy",function(d){ return y(d.age); })
      .attr("fill",function(d){ return c(d.sex); })
      .attr("stroke",function(d){ return s(d.survived); })
      .attr("stroke-width","0px");

  //EXIT
  scatter.exit().transition().duration(1000)
      .attr("cx",0)
      .attr("fill-opacity",0)
      .remove();
}

function dataFetch(start,stop){
  if(stop<=allData.length){
    update(allData.slice(start,stop));
  }
  else{
    var remainder = stop-allData.length;
    update(allData.slice(start,allData.length).concat(allData.slice(0,remainder)));
  }
}

</script>
							
						</div>
						<div class="4u 6u$(2) 12u$(3)">
							<section class="feature fa-code">
								<h3>Ultricies dolore</h3>
								<p>Ipsum dolor tempus commodo amet sed accumsan et adipiscing blandit porttitor sed faucibus.</p>
							</section>
						</div>
						<div class="4u$ 6u(2) 12u$(3)">
							<section class="feature fa-save">
								<h3>Magna lacinia</h3>
								<p>Ipsum dolor tempus commodo amet sed accumsan et adipiscing blandit porttitor sed faucibus.</p>
							</section>
						</div>
						<div class="4u 6u$(2) 12u$(3)">
							<section class="feature fa-desktop">
								<h3>Praesent lacinia</h3>
								<p>Ipsum dolor tempus commodo amet sed accumsan et adipiscing blandit porttitor sed faucibus.</p>
							</section>
						</div>
						<div class="4u 6u(2) 12u$(3)">
							<section class="feature fa-camera-retro">
								<h3>Morbi semper</h3>
								<p>Ipsum dolor tempus commodo amet sed accumsan et adipiscing blandit porttitor sed faucibus.</p>
							</section>
						</div>
						<div class="4u$ 6u$(2) 12u$(3)">
							<section class="feature fa-cog">
								<h3>Arcu consequat</h3>
								<p>Ipsum dolor tempus commodo amet sed accumsan et adipiscing blandit porttitor sed faucibus.</p>
							</section>
						</div>
					</div>
				</div>
			</section>
			
		<!-- CTA -->
			<section id="cta" class="wrapper style3">
				<h2>Sed faucibus et consequat</h2>
				<ul class="actions">
					<li><a href="#" class="button big">Get Started</a></li>
				</ul>
			</section>
			
	</body>
</html>
